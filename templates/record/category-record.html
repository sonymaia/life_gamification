{% extends 'record/base.html' %}
{% load static %}


{% block content %}

<div class="container my-5 col-sm-8">
    <div id="form-add" style="display:none;">
        {% include 'partials/_category-record.html' %}
    </div>
    {% include 'partials/_alerts.html' %}
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-success " id="toggle-button" onclick="toggleForm()">Add</button>
    </div>

    {% if categories %}
    <div class="container card my-3">
        <!-- <form method="GET" class="form-inline mb-3">
            <div class="form-group mb-3">
                <label for="category_filter">Categoria:</label>
                <input type="text" class="form-control" name="category_filter" id="category_filter">
            </div>
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </form> -->
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th>Data</th>
                    <th>Editar</th>
                    <th>Excluir</th>
                    <!-- <th>Usuário</th> -->
                </tr>
            </thead>
            <tbody>
                {% for category in categories %}
                <tr>
                    <td>{{ category.fk_category }}</td>
                    <td>{{ category.description }}</td>
                    <td>{{ category.date }}</td>
                    <td>
                        <button class="btn btn-primary edit-button d-flex flex-column flex-md-row align-items-md-center"
                            data-id="{{ category.id }}"><i class="bi bi-pencil-square"></i></button>
                    </td>
                    <td>
                        <button
                            class="btn btn-danger delete-button d-flex flex-column flex-md-row align-items-md-center"
                            data-id="{{ category.id }}"><i class="bi bi-trash"></i></button>
                    </td>

                    <!-- <td><button class="btn btn-danger delete-button">Deletar</button></td> -->
                    <!-- <td>{{ category.fk_user }}</td> -->
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

</div>


<script src="{% static 'js/script.js' %}" ></script>
<script>
    // mostra e esconde a div para adicionar uma nova categoria
    function toggleForm() {
        var formSection = document.getElementById("form-add");
        var toggleButton = document.getElementById("toggle-button");
        if (formSection.style.display === "none") {
            formSection.style.display = "block";
            toggleButton.classList.remove("btn-success");
            toggleButton.classList.add("btn-danger");
            toggleButton.innerHTML = "Cancelar";
        } else {
            formSection.style.display = "none";
            toggleButton.classList.remove("btn-danger");
            toggleButton.classList.add("btn-success");
            toggleButton.innerHTML = "Add";
        }
    }

    // selecione todos os botões de editar e adicione um evento de clique a eles
    var editButtons = document.querySelectorAll('.edit-button');
    editButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            // obtenha o id do registro a partir do valor do atributo data-id do botão de editar
            var recordId = button.getAttribute('data-id');

            // redirecione para a página de edição correspondente
            window.location.href = `/category-record/edit/${recordId}/`;
        });
    });

    // selecione todos os botões de deletar e adicione um evento de clique a eles
    var deleteButtons = document.querySelectorAll('.delete-button');
    deleteButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            // obtenha o id do registro a partir do valor do atributo data-id do botão de deletar
            var recordId = button.getAttribute('data-id');

            // exiba uma mensagem de confirmação antes de excluir o registro
            if (confirm('Tem certeza que deseja deletar este registro?')) {
                // obtenha o valor do token CSRF do cookie
                const csrftoken = getCookie('csrftoken');

                // faça uma solicitação POST para excluir o registro
                fetch(`/category-record/delete/${recordId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({})
                })
                    .then(response => {
                        // recarregue a página após a exclusão do registro
                        window.location.reload();
                    });
            }
        });
    });

    


</script>



{% endblock %}